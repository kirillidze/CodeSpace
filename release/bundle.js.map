{"version":3,"file":"bundle.js","sources":["webpack:///webpack/bootstrap","webpack:///./src/js/Router.js"],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 9);\n","'use strict';\r\nimport {\r\n\tPromoModel\r\n} from \"./PromoModel.js\";\r\nimport {\r\n\tPromoView\r\n} from \"./PromoView.js\";\r\nimport {\r\n\tPromoController\r\n} from \"./PromoController.js\";\r\nimport {\r\n\tPopupView\r\n} from \"./PopupView.js\";\r\nimport {\r\n\tPopupController\r\n} from \"./PopupController.js\";\r\n\r\nimport {\r\n\tDashboardModel\r\n} from \"./DashboardModel.js\";\r\nimport {\r\n\tDashboardView\r\n} from \"./DashboardView.js\";\r\nimport {\r\n\tDashboardController\r\n} from \"./DashboardController.js\";\r\n\r\nimport {\r\n\tProjectModel\r\n} from \"./ProjectModel.js\";\r\nimport {\r\n\tProjectView\r\n} from \"./ProjectView.js\";\r\nimport {\r\n\tProjectController\r\n} from \"./ProjectController.js\";\r\n\r\nimport {\r\n\tUserWinView\r\n} from \"./UserWinView.js\";\r\nimport {\r\n\tUserWinController\r\n} from \"./UserWinController.js\";\r\nimport {\r\n\tOutputView\r\n} from \"./OutputView.js\";\r\nimport {\r\n\tOutputController\r\n} from \"./OutputController.js\";\r\n\r\nvar ajaxHandlerScript = 'https://fe.it-academy.by/AjaxStringStorage2.php';\r\n\r\nexport class Router {\r\n\tconstructor() {\r\n\t\tthis.user = localStorage.user;\r\n\r\n\t\tthis.modelOfPromo = null;\r\n\t\tthis.viewOfPromo = null;\r\n\t\tthis.controllerOfPromo = null;\r\n\t\tthis.viewOfPopup = null;\r\n\t\tthis.controllerOfPopup = null;\r\n\r\n\t\tthis.modelOfList = null;\r\n\t\tthis.viewOfList = null;\r\n\t\tthis.controllerOfList = null;\r\n\r\n\t\tthis.modelOfProject = null;\r\n\t\tthis.viewOfProject = null;\r\n\t\tthis.controllerOfProject = null;\r\n\t\tthis.viewOfUser = null;\r\n\t\tthis.controllerOfUser = null;\r\n\t\tthis.viewOfOutput = null;\r\n\t\tthis.controllerOfOutput = null;\r\n\t\tthis.createdHash = null;\r\n\r\n\t\tthis.createPromise = (context, data) => {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: ajaxHandlerScript,\r\n\t\t\t\t\t\ttype: 'POST',\r\n\t\t\t\t\t\tcache: false,\r\n\t\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\t\tcontext: context,\r\n\t\t\t\t\t\tdata: data,\r\n\t\t\t\t\t\tsuccess: resolve,\r\n\t\t\t\t\t\terror: reject\r\n\t\t\t\t\t});\r\n\t\t\t\t} catch (ex) {\r\n\t\t\t\t\tconsole.log(ex);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\t\t//Подписаться на событие hashchange\r\n\t\twindow.addEventListener('hashchange', this.onhashchange.bind(this));\r\n\r\n\r\n\t\tif (!localStorage.user) { //!localStorage.user - при пустом попадаем на промо\r\n\t\t\tthis.navigateTo('#promo');\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif (document.location.hash === '' || document.location.hash === '#promo') {\r\n\t\t\t\t//при загрузке сразу попадаем на стену\r\n\t\t\t\tthis.navigateTo('#dashboard');\r\n\t\t\t} else {\r\n\t\t\t\t//иначе переходим по введённому хешу\r\n\t\t\t\tthis.navigateTo(document.location.hash);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tonhashchange() {\r\n\t\tconst activeHash = document.location.hash;\r\n\t\t// Отрисовать страницу для нового адреса\r\n\t\tthis.route(activeHash);\r\n\r\n\t}\r\n\r\n\troute(route) {\r\n\r\n\t\t//ничего не делаем, если перешли по нерабочей ссылке\r\n\t\tif (route == '#test') return;\r\n\r\n\t\t//удаляем решётку\r\n\t\troute = route.substr(1);\r\n\r\n\t\tif (!localStorage.user) { //!localStorage.user - при пустом попадаем на промо\r\n\r\n\t\t\t//инициируем MVC PROMO\r\n\t\t\tthis.modelOfPromo = new PromoModel();\r\n\t\t\tthis.viewOfPromo = new PromoView(this.modelOfPromo);\r\n\t\t\tthis.controllerOfPromo = new PromoController(this.modelOfPromo);\r\n\r\n\t\t\tthis.viewOfPopup = new PopupView(this.modelOfPromo);\r\n\t\t\tthis.controllerOfPopup = new PopupController(this.modelOfPromo);\r\n\r\n\t\t\tthis.modelOfPromo.changes\r\n\t\t\t\t.sub('changeUser', this.setUser.bind(this));\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif (route === 'dashboard') {\r\n\t\t\t\t//инициируем MVC DASHBOARD\r\n\t\t\t\tthis.modelOfList = new DashboardModel(this.user);\r\n\t\t\t\tthis.viewOfList = new DashboardView(this.modelOfList);\r\n\t\t\t\tthis.controllerOfList = new DashboardController(this.modelOfList);\r\n\r\n\t\t\t\tthis.modelOfList.changes\r\n\t\t\t\t\t.sub('logOut', this.logOutUser.bind(this));\r\n\t\t\t\tthis.modelOfList.changes\r\n\t\t\t\t\t.sub('createNewProject', this.navigateToNewProject.bind(this));\r\n\r\n\t\t\t} else {\r\n\t\t\t\t//должен быть user\r\n\t\t\t\tif(this.user) {\r\n\t\t\t\t\t//получаем данные с сервера\r\n\t\t\t\t\tvar self = this; // контекст для запроса\r\n\t\t\t\t\t//запрос на чтение\r\n\t\t\t\t\tthis.createPromise(self, {\r\n\t\t\t\t\t\tf: 'READ',\r\n\t\t\t\t\t\tn: 'CodeSpace'\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then(response => {\r\n\t\t\t\t\t\tif (response.error !== undefined) {\r\n\t\t\t\t\t\t\talert(response.error);\r\n\t\t\t\t\t\t} else if (response !== \"\") {\r\n\t\t\t\t\t\t\t// ответ с сервера\r\n\t\t\t\t\t\t\tlet dataFromServer = JSON.parse(response.result),\r\n\t\t\t\t\t\t\t\t// список хэшей существующих проектов\r\n\t\t\t\t\t\t\t\tprojectList = Object.keys(dataFromServer[this.user].projects);\r\n\t\t\t\t\t\t\t\t// чтобы пропустить создаваемый проект, добавим его к существующим\r\n\t\t\t\t\t\t\t\tif (this.createdHash) {\r\n\t\t\t\t\t\t\t\t\tprojectList.push(this.createdHash);\r\n\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor (let i = 0; i < projectList.length; i++) {\r\n\t\t\t\t\t\t\t\t// если роут равен одному из списка выше, можно показывать страницу\r\n\t\t\t\t\t\t\t\tif (projectList[i] === route) {\r\n\r\n\t\t\t\t\t\t\t\t\t//отписываем предыдущие представления от изменений модели\r\n\t\t\t\t\t\t\t\t\tif (this.modelOfProject) {\r\n\t\t\t\t\t\t\t\t\t\tthis.viewOfOutput.unsubscribe();\r\n\t\t\t\t\t\t\t\t\t\tthis.viewOfProject.unsubscribe();\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t//инициируем общую модель проекта\r\n\t\t\t\t\t\t\t\t\tthis.modelOfProject = new ProjectModel(route, this.user);\r\n\r\n\t\t\t\t\t\t\t\t\t//инициируем пользовательский MVC проекта (левый)\r\n\t\t\t\t\t\t\t\t\tthis.viewOfUser = new UserWinView(this.modelOfProject);\r\n\t\t\t\t\t\t\t\t\tthis.controllerOfUser = new UserWinController(this.modelOfProject);\r\n\r\n\t\t\t\t\t\t\t\t\t//инициируем MVC вывода данных проекта (правый)\r\n\t\t\t\t\t\t\t\t\tthis.viewOfOutput = new OutputView(this.modelOfProject);\r\n\t\t\t\t\t\t\t\t\tthis.controllerOfOutput = new OutputController(this.modelOfProject);\r\n\r\n\t\t\t\t\t\t\t\t\t//инициируем общие представление и контроллер проекта\r\n\t\t\t\t\t\t\t\t\tthis.viewOfProject = new ProjectView(this.modelOfProject);\r\n\t\t\t\t\t\t\t\t\tthis.controllerOfProject = new ProjectController(this.modelOfProject);\r\n\r\n\t\t\t\t\t\t\t\t\tthis.modelOfProject.changes\r\n\t\t\t\t\t\t\t\t\t\t.sub('logOut', this.logOutUser.bind(this));\r\n\t\t\t\t\t\t\t\t\tthis.modelOfProject.changes\r\n\t\t\t\t\t\t\t\t\t\t.sub('createNewProject', this.navigateToNewProject.bind(this));\r\n\t\t\t\t\t\t\t\t\tbreak;\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t} \r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(error => {\r\n\t\t\t\t\t\tconsole.log(\"На этапе запроса на сервер случилась ошибка: \" + error);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else return;\t\t\t\t\r\n\t\t\t} \r\n\t\t}\r\n\t}\r\n\r\n\tnavigateTo(route) {\r\n\t\t// Выполнить начальную навигацию на адрес по умолчанию\r\n\t\tif (document.location.hash === route) {\r\n\t\t\tthis.route(route);\r\n\t\t} else {\t\t\t\r\n\t\t\tdocument.location.hash = route;\r\n\t\t}\r\n\t}\r\n\r\n\tsetUser(activeUser) {\r\n\t\tthis.user = activeUser;\r\n\t\tthis.navigateTo('#dashboard');\r\n\t}\r\n\r\n\tlogOutUser() {\r\n\t\tthis.user = null;\r\n\t\tthis.navigateTo('#promo');\r\n\t}\r\n\r\n\tnavigateToNewProject(date) {\r\n\t\tthis.navigateTo(`#project${date}`);\r\n\t\t//запишем новый хэш, чтобы можно было пройти проверку\r\n\t\tthis.createdHash = `project${date}`;\r\n\t}\r\n\r\n}"],"mappings":"AACA;;ACiGA;;AAiCA","sourceRoot":""}